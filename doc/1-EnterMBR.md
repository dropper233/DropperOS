# 1 | Enter MBR
>System will enter MBR when computer starting. So we need to code a code for system enter MBR.

## Step 0: Create the source folder and the code file.
* Create some folders and files as below:  
  | folder/file name  | type      |
  |-------------------|-----------|
  | [ProjectFolder]   | original  |
  | + src             | folder    |
  | + + kernel        | folder    |
  | makefile          | file      |
  | [*system_name*.img] | original  |
* Enter the folder "src/kernel" and then create a file "boot.asm" as below:
  | folder/file name  | type      |
  |-------------------|-----------|
  | [ProjectFolder]   | original  |
  | + src             | folder    |
  | + + kernel        | folder    |
  | + + + boot.asm    | file(asm) |
  | makefile          | file      |
  | [*system_name*.img] | original  |

## Step 1: Code your first asm code.
* open the file *"boot.asm"*, and then code some code as below:
  ```asm
  [org 0x7c00]

  ; Initialize somethings.
  mov ax, 3
  int 0x10 ; set screen mode and clear screen

  mov ax, 0
  mov ds, ax
  mov es, ax
  mov ss, ax
  mov sp, 0x7c00

  ; Call the print function.
  mov si, str_helloworld
  call print

  ; The print function.
  ; void print(addr si);
  print:
      mov ah, 0x0e
  .start:
      mov al, [si]
      cmp al, 0 
      jz .done
      int 0x10
      inc si
      jmp .start
  .done:
      ret

  str_helloworld:
      db "Hello world!", 10, 13, 0

  hlt ; Stop here.

  times 510 - ($ - $$) db 0
  dw 0xaa55
  ```
 * The above code can make the system enter to MBR(run in real mode then) and print a string "Hello world!".

> ## What is MBR and what do the last two lines of the file "boot.asm" do?
> **MBR** is "**master boot record**". Entering the MBR is actually entering **the main boot sector** (sector 0).  
> Our system is booting from **the main boot sector(MBR)**, but MBR has only **512 bytes**, so the penultimate two lines of the file *"boot.asm"* `times 510 - ($ - $$) db 0` will full it to **510 bytes**. And because the last two bytes of the binary file in MBR must is **0xaa55(0x55, 0xaa)**, so the last line of the file *"boot.asm"* `dw 0xaa55` will write the two bytes "0xaa55" to the binary file *"boot.bin"(The binary file generated by the "boot.asm" compilation)*. So the binary file "boot.bin" will be 512 bytes.

## Step 2: Create and "make" a makefile.
* Open the file *"makefile"*, and then code some makefile code as below:
  ```makefile
  ; Variables.
  KERNEL_SRC := ./src/kernel
  BUILD := ./build
  K_OBJ_ASM := $(BUILD)/boot.bin
  K_OBJ := $(K_OBJ_ASM)

  ; Compile the objects.
  $(K_OBJ_ASM): $(KERNEL_SRC)/boot.asm
    @-mkdir -p BUILD
    @echo "Compiling the asm files..."
    nasm $^ -o $@ -f bin
    @echo "Compiled done!"

  ; Write the objects to "[system_name].img"
  [system_name].img: $(BUILD)/boot.bin
    @ehco "Writing the files to the image file..."
    qemu-img create $@ -o size=64M -q
    dd if=$(BUILD)/boot.bin of=$@ bs=512 count=1 conv=notrunc
    @ehco "Write done!"

  all: $(K_OBJ_ASM) [system_name].img

  .PHONY: clean qemu

  clean:
    @rm -rf BUILD [system_name].img
    @clear
    @echo "Here are the folders and files in this workspace:"
    @ls

  ; Start the qemu to running the system.
  qemu:
    @qemu-system-x86_64 -m 1024M -hda [system_name].img
  ```
  > Replace **[system_name]** with your system name.
  * The above makefile code can help you to build the system.

* Enter the command `make all` in your terminal, after that it will generate a folder *"build"* and a image(.img) file *"**[system_name]**.img"*
* Enter the command `make qemu` in your terminal, after that it will start a qemu program to loading your system, and then you can see a line of text "Hello world! " on the "screen" of the qemu program.
* Enter the command `make clean` in your terminal, after that it will remove the folder *"build"* and the image file *"**[system_name]**.img"*. it also will clear the output texts on your terminal and show the folders and files in your workspace.

> If you can see a line of text "Hello world! " on the "screen" of the qemu program, it means that your system can enter MBR correctly.

> You are done. Enjoy the code!